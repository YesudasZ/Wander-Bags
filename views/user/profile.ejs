<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
  <meta charset="utf-8">
  <title>Wander - eCommerce HTML Template</title>
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="og:title" content="">
  <meta property="og:type" content="">
  <meta property="og:url" content="">
  <meta property="og:image" content="">
  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="user-assets/imgs/theme/favicon.svg">
  <!-- Template CSS -->
  <link rel="stylesheet" href="user-assets/css/main.css?v=3.4">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastify-js/1.11.0/toastify.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-KyZXEAg3QhqLMpG8r+Knujsl5+Z3+Xf1QojCaB40CKvL+2K4Y5p4ef5uyyJ5fksU" crossorigin="anonymous">
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="SHA-384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.3/dist/sweetalert2.min.css">
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

  <style>


.table-header th {
  font-weight: bold;
}

.table-header th,
.table-header td {
  text-align: center;
}

.table .text-warning {
  color: orange;
}

.table .text-success {
  color: green;
}




    .error-message {
      color: red;
      font-size: 0.8rem;
    }

    /* Dashboard Menu Styles */
    .dashboard-menu {
      background-color: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
    }

    .dashboard-menu ul {
      list-style: none;
      padding: 0;
    }

    .dashboard-menu .nav-link {
      color: #343a40;
      text-decoration: none;
      transition: all 0.3s ease;
    }

    .dashboard-menu .nav-link:hover {
      color: #007bff;
    }

    /* Dashboard Content Styles */
    .dashboard-content {
      padding: 20px;
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
    }

    .dashboard-content .card-header {
      background-color: #f8f9fa;
      border-bottom: 1px solid #dee2e6;
    }

    .dashboard-content .card-header h5 {
      color: #343a40;
    }

    .dashboard-content .btn-small {
      background-color: #007bff;
      color: #fff;
      border: none;
      border-radius: 5px;
      padding: 5px 10px;
      text-decoration: none;
      transition: all 0.3s ease;
    }

    .dashboard-content .btn-small:hover {
      background-color: #0056b3;
    }

    @media (max-width: 767.98px) {
      .dashboard-menu {
        margin-bottom: 20px;
      }
    }

    /* Sidebar Styles */
    .sidebar {
      height: 100%;
      width: 250px;
      background-color: #f8f9fa;
      padding: 20px;
    }

    /* Main Content Styles */
    .main-content {
      margin-left: 250px;
      /* Same width as the sidebar */
      padding: 20px;
    }

    /* Footer Styling */
    footer.main {
      padding-top: 40px;
      padding-bottom: 40px;
    }

    .widget-about p {
      color: #a8a8a8;
      line-height: 1.8;
    }

    .social-icons a {
      display: inline-block;
      margin-right: 10px;
    }

    .widget-title {
      color: #fff;
      font-weight: bold;
    }

    .footer-list li {
      list-style: none;
    }

    .download-app img {
      max-width: 130px;
      margin-right: 10px;
      margin-bottom: 10px;
    }

    .font-sm {
      font-size: 14px;
    }

    .text-light {
      color: #fff !important;
    }

    .text-muted {
      color: #a8a8a8 !important;
    }

    .header-info-right ul li {
      display: inline;
      margin-left: 20px;
    }

    .header-info-right ul li:first-child {
      margin-left: 0;
    }

    .header-info-right a {
      text-decoration: none;
      color: #343a40;
      /* Adjust text color as needed */
    }

    .header-info-right a:hover {
      text-decoration: underline;
    }

    .header-info-right .fi-rs-user {
      margin-right: 5px;
    }
  </style>
</head>

<body>
  <!-- Quick view -->

  <header class="header-area header-style-4 header-height-2">
    <div class="header-middle header-middle-ptb-1 d-none d-lg-block">
      <div class="container">
        <div class="header-wrap d-flex justify-content-between align-items-center">
          <div class="logo logo-width-1">
            <a href="index.html"><img src="user-assets/imgs/theme/logo.svg" alt="logo"></a>
          </div>
          <div class="header-right d-flex align-items-center">
            <div class="search-style-2">
              <form action="#">
                <select class="select-active">
                  <option>All Categories</option>
                </select>
                <input type="text" placeholder="Search for items...">
              </form>
            </div>
            <div class="header-action-right d-flex align-items-center">
              <div class="header-action-2">
                <div class="header-action-icon-2">
                  <a href="shop-wishlist.html">
                    <img class="svgInject" alt="Wander" src="user-assets/imgs/theme/icons/icon-heart.svg">

                  </a>
                </div>
                <div class="header-action-icon-2">
                  <a class="mini-cart-icon" href="/cart">
                    <img alt="Wander" src="user-assets/imgs/theme/icons/icon-cart.svg">

                  </a>
                </div>
              </div>
              <div class="header-info header-info-right text-end">
                <ul class="list-inline mb-0">

                  <li class="dropdown nav-item m-5">
                    <a class="dropdown-toggle text-black" href="#" role="button" id="userDropdown"
                      data-bs-toggle="dropdown" aria-expanded="false">
                      <i class="fi-rs-user"></i>
                      <%= user.name %>
                    </a>
                    <div class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownAccount">
                      <a class="dropdown-item" href="#"><i class="material-icons md-perm_identity"></i>Profile</a>
                      <a class="dropdown-item" href="#"><i class="material-icons md-settings"></i>Orders</a>
                      <a class="dropdown-item" href="#"><i
                          class="material-icons md-account_balance_wallet"></i>Wallet</a>
                      <div class="dropdown-divider"></div>
                      <a class="dropdown-item text-danger" href="/logout"><i
                          class="material-icons md-exit_to_app"></i>Logout</a>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="header-bottom header-bottom-bg-color sticky-bar">
      <div class="container">
        <div class="header-wrap header-space-between position-relative">
          <div class="logo logo-width-1 d-block d-lg-none">
            <a href="index.html"><img src="user-assets/imgs/theme/logo.svg" alt="logo"></a>
          </div>
          <div class="header-nav d-none d-lg-flex">
            <div class="main-menu main-menu-padding-1 main-menu-lh-2 d-none d-lg-block">
              <nav>
                <ul>
                  <li><a href="/home">Home</a></li>
                  <li><a class="active" href="/shop">Shop</a></li>
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="main">
    <section class="pt-50 pb-50">
      <div class="container">
        <div class="row">
          <div class="col-md-4">
            <div class="dashboard-menu">
              <ul class="nav flex-column" role="tablist">
                <li class="nav-item">
                  <a class="nav-link active" id="account-detail-tab" data-bs-toggle="tab" href="#account-detail"
                    role="tab" aria-controls="account-detail" aria-selected="false">
                    <i class="fi-rs-user mr-10"></i>Account details
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" id="address-tab" data-bs-toggle="tab" href="#address" role="tab"
                    aria-controls="address" aria-selected="true">
                    <i class="fi-rs-marker mr-10"></i>My Address
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" id="addaddress-tab" data-bs-toggle="tab" href="#addaddress" role="tab"
                    aria-controls="addaddress" aria-selected="true">
                    <i class="fi-rs-marker mr-10"></i>Add Address
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" id="orders-tab" data-bs-toggle="tab" href="#orders" role="tab"
                    aria-controls="orders" aria-selected="false">
                    <i class="fi-rs-shopping-bag mr-10"></i>Orders
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" id="orders-tab" data-bs-toggle="tab" href="#Wallet" role="tab"
                    aria-controls="orders" aria-selected="false"><i class="fi-rs-shopping-bag mr-10"></i>Wallet</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/logout">
                    <i class="fi-rs-sign-out mr-10"></i>Logout
                  </a>
                </li>
              </ul>
            </div>
          </div>
          <div class="col-md-8">
            <div class="tab-content dashboard-content">
              <div class="tab-pane fade active show" id="account-detail" role="tabpanel"
                aria-labelledby="account-detail-tab">
                <div class="card">
                  <div class="card-header">
                    <h5>Account Details</h5>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <div class="form-group col-md-6">
                        <label>Name <span class="required">*</span></label>
                        <input class="form-control square" value="<%= user.name %>" name="name" type="text" readonly>
                        <button type="button" class="btn btn-link" data-bs-toggle="modal"
                          data-bs-target="#editNameModal">Edit</button>
                      </div>
                      <div class="form-group col-md-6">
                        <label>Mobile <span class="required">*</span></label>
                        <input class="form-control square" value="<%= user.mobile %>" name="mobile" type="number"
                          readonly>
                      </div>
                      <div class="form-group col-md-12">
                        <label>Email Address <span class="required">*</span></label>
                        <input class="form-control square" value="<%= user.email %>" name="email" type="email" readonly>
                      </div>
                      <div class="col-md-12">
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal"
                          data-bs-target="#changePasswordModal">Change Password</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="tab-pane fade" id="orders" role="tabpanel" aria-labelledby="orders-tab">
                <div class="card">
                  <div class="card-header">
                    <h5 class="mb-0">Your Orders</h5>
                  </div>
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th>Product</th>
                        <th>Quantity</th>
                        <th>Status</th>
                        <th>Action</th>
                      </tr>
                    </thead>
                    <tbody>
                      <% orders.forEach(order=> { %>
                        <% order.items.forEach((item, index)=> { %>
                          <tr class="order-row" data-order-id="<%= order._id %>">
                            <td>
                              <div class="d-flex align-items-center">
                                <img src="/productimages/<%= item.image[0] %>" alt="<%= item.title %>" class="mr-3"
                                  style="width: 100px; height: 100px;">
                                <span>
                                  <%= item.title %>
                                </span>
                              </div>
                            </td>
                            <td>
                              <%= item.quantity %>
                            </td>
                            <td><span
                                class="badge order-status badge-<%= order.orderStatus.toLowerCase() === 'pending' ? 'warning' : order.orderStatus.toLowerCase() === 'confirmed' ? 'info' : order.orderStatus.toLowerCase() === 'shipped' ? 'primary' : order.orderStatus.toLowerCase() === 'delivered' ? 'success' : 'danger' %>">
                                <%= order.orderStatus %>
                              </span></td>
                            <td>
                              <% if (order.orderStatus.toLowerCase()==='pending' ||
                                order.orderStatus.toLowerCase()==='confirmed' ) { %>
                                <button type="button" class="btn btn-danger btn-sm" data-toggle="modal"
                                  data-target="#cancelOrderModal" data-order-id="<%= order._id %>">Cancel Order</button>
                                <% } else if (order.orderStatus.toLowerCase()==='delivered' ) { %>
                                  <button type="button" class="btn btn-danger btn-sm" data-toggle="modal"
                                    data-target="#returnOrderModal" data-order-id="<%= order._id %>">Return
                                    Order</button>
                                  <% } else { %>
                                    <button class="btn btn-secondary btn-sm" disabled>Cancel Order</button>
                                    <% } %>
                            </td>
                          </tr>
                          <% }) %>
                            <% }) %>
                    </tbody>
                  </table>
                </div>
              </div>


              <!-- Return Order Modal -->
              <div class="modal fade" id="returnOrderModal" tabindex="-1" role="dialog"
                aria-labelledby="returnOrderModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="returnOrderModalLabel">Return Order</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <form id="returnOrderForm">
                        <div class="form-group">
                          <label for="returnReason">Reason for Return</label>
                          <input type="text" class="form-control" id="returnReason" required>
                        </div>
                      </form>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                      <button type="button" class="btn btn-primary" id="confirmReturnOrder">Confirm Return</button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="tab-pane fade" id="Wallet" role="tabpanel" aria-labelledby="orders-tab">
                <div class="wallet-info">
                  <h6 class="wallet-balance">Wallet Balance: <%= wallet ? wallet.walletBalance.toFixed(2) : '0.00' %></h6>
                </div>
                <div class="card-body">
                  <div class="table-responsive">
                    <table class="table table-hover">
                      <thead>
                        <tr class="table-header">
                          <th>Order Id</th>
                          <th>Amount</th>
                          <th>Order Status</th>
                          <th>Payment Method</th>
                          <th>Payment Status</th>
                          <th>Transaction Date</th>
                        </tr>
                      </thead>
                      <tbody>
                        <% orders.forEach(order=> { %>
                          <% order.items.forEach(item=> { %>
                            <% if (order.orderStatus==='Returned' ) { %>
                              <tr>
                                <td><%= order.oId %></td>
                                <td><%= item.price.toFixed(2) %></td>
                                <td><%= order.orderStatus %></td>
                                <td><%= order.paymentMethod %></td>
                                <td class="<%= order.paymentStatus === 'Pending' ? 'text-warning' : order.paymentStatus === 'Refunded' ? 'text-success' : '' %>"><%= order.paymentStatus %></td>
                                <td><%= order.orderDate.toDateString() %></td>
                              </tr>
                            <% } %>
                          <% }) %>
                        <% }) %>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
              

              
              



              <!-- Cancel Order Modal -->
              <div class="modal fade" id="cancelOrderModal" tabindex="-1" role="dialog"
                aria-labelledby="cancelOrderModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="cancelOrderModalLabel">Cancel Order</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <form id="cancelOrderForm">
                        <div class="form-group">
                          <label for="cancellationReason">Reason for Cancellation</label>
                          <textarea class="form-control" id="cancellationReason" rows="3" required></textarea>
                        </div>
                      </form>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                      <button type="button" class="btn btn-danger" id="confirmCancelOrder">Confirm Cancel</button>
                    </div>
                  </div>
                </div>
              </div>





              <div class="tab-pane fade" id="addaddress" role="tabpanel" aria-labelledby="addaddress-tab">
                <div class="card">
                  <div class="card-header">
                    <h5>Add Address</h5>
                  </div>
                  <div class="card-body">
                    <form id="addAddressForm" method="post" name="enq" onsubmit="return validateForm()">
                      <div class="row">
                        <div class="form-group col-md-6">
                          <label>House Name / Flat No.<span class="required">*</span></label>
                          <input class="form-control square" name="houseName" id="houseName" type="text">
                          <small class="text-danger invalid-feedback"></small>
                        </div>
                        <div class="form-group col-md-6">
                          <label>Street<span class="required">*</span></label>
                          <input class="form-control square" name="street" id="street" type="text">
                          <small class="text-danger invalid-feedback"></small>
                        </div>
                        <div class="form-group col-md-12">
                          <label>City <span class="required">*</span></label>
                          <input class="form-control square" name="city" id="city" type="text" pattern="^[a-zA-Z\s]+$">
                          <small class="text-danger invalid-feedback">gjagjkgajkhgf</small>
                        </div>
                        <div class="form-group col-md-12">
                          <label>State <span class="required">*</span></label>
                          <input class="form-control square" name="state" id="state" type="text"
                            pattern="^[a-zA-Z\s]+$">
                          <small class="text-danger invalid-feedback"></small>
                        </div>
                        <div class="form-group col-md-12">
                          <label>Country <span class="required">*</span></label>
                          <input class="form-control square" name="country" id="country" type="text"
                            pattern="^[a-zA-Z\s]+$">
                          <small class="text-danger invalid-feedback"></small>
                        </div>
                        <div class="form-group col-md-12">
                          <label>Postalcode <span class="required">*</span></label>
                          <input class="form-control square" name="postalCode" id="postalCode" type="text"
                            pattern="^[0-9]+$">
                          <small class="text-danger invalid-feedback"></small>
                        </div>
                        <div class="form-group col-md-12">
                          <label>Type <span class="required">*</span></label>
                          <select class="form-control" id="addressType" name="addressType">
                            <option value="home">Home</option>
                            <option value="office">Office</option>
                          </select>
                          <small class="text-danger invalid-feedback"></small>
                        </div>
                        <div class="col-md-12">
                          <button type="submit" class="btn btn-fill-out submit" name="submit"
                            value="Submit">Save</button>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>

              <!-- Profile Address Management Section -->
              <div class="tab-pane fade" id="address" role="tabpanel" aria-labelledby="address-tab">
                <div class="row">
                  <% user.address.forEach((address, index)=> { %>
                    <div class="col-lg-6 mb-4" id="addressSection_<%= address._id %>">
                      <div class="card mb-3 mb-lg-0">
                        <div class="card-header">
                          <h5 class="mb-0">
                            <%= address.type.charAt(0).toUpperCase() + address.type.slice(1) %> Address
                          </h5>
                        </div>
                        <div class="card-body">
                          <ul class="list-unstyled">
                            <li><strong>House Name / Flat No.:</strong> <span class="house-name">
                                <%= address.houseName %>
                              </span></li>
                            <li><strong>Street:</strong> <span class="street">
                                <%= address.street %>
                              </span></li>
                            <li><strong>City:</strong> <span class="city">
                                <%= address.city %>
                              </span></li>
                            <li><strong>State:</strong> <span class="state">
                                <%= address.state %>
                              </span></li>
                            <li><strong>Country:</strong> <span class="country">
                                <%= address.country %>
                              </span></li>
                            <li><strong>Postal Code:</strong> <span class="postal-code">
                                <%= address.postalCode %>
                              </span></li>
                          </ul>
                          <!-- Edit and Delete buttons -->
                          <div class="d-flex justify-content-between align-items-center mt-3">
                            <button type="button" class="btn btn-primary" data-toggle="modal"
                              data-target="#editAddressModal<%= index %>">Edit</button>
                            <button type="button" class="btn btn-danger" data-toggle="modal"
                              data-target="#deleteAddressModal<%= index %>">Delete</button>
                          </div>
                        </div>
                      </div>
                    </div>
                    <% }) %>
                </div>
              </div>

              <!-- Edit Address Modal -->
              <% user.address.forEach((address, index)=> { %>
                <div class="modal fade" id="editAddressModal<%= index %>" tabindex="-1" role="dialog"
                  aria-labelledby="editAddressModalLabel<%= index %>" aria-hidden="true">
                  <div class="modal-dialog" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="editAddressModalLabel<%= index %>">Edit Address</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <div class="modal-body">
                        <!-- Form for editing address -->
                        <form id="editAddressForm<%= index %>" class="edit-address-form"
                          data-address-id="<%= address._id %>">
                          <div class="form-group">
                            <label for="houseName<%= index %>">House Name / Flat No.</label>
                            <input type="text" class="form-control" id="houseName<%= index %>" name="houseName"
                              value="<%= address.houseName %>" required>
                          </div>
                          <div class="form-group">
                            <label for="street<%= index %>">Street</label>
                            <input type="text" class="form-control" id="street<%= index %>" name="street"
                              value="<%= address.street %>" required>
                          </div>
                          <div class="form-group">
                            <label for="city<%= index %>">City</label>
                            <input type="text" class="form-control" id="city<%= index %>" name="city"
                              value="<%= address.city %>" required>
                          </div>
                          <div class="form-group">
                            <label for="state<%= index %>">State</label>
                            <input type="text" class="form-control" id="state<%= index %>" name="state"
                              value="<%= address.state %>" required>
                          </div>
                          <div class="form-group">
                            <label for="country<%= index %>">Country</label>
                            <input type="text" class="form-control" id="country<%= index %>" name="country"
                              value="<%= address.country %>" required>
                          </div>
                          <div class="form-group">
                            <label for="postalCode<%= index %>">Postal Code</label>
                            <input type="text" class="form-control" id="postalCode<%= index %>" name="postalCode"
                              value="<%= address.postalCode %>" required>
                          </div>
                          <div class="modal-footer">
                            <button type="submit" class="btn btn-primary">Update</button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
                <% }) %>


                  <!-- Delete Address Modal -->
                  <% user.address.forEach((address, index)=> { %>
                    <div class="modal fade" id="deleteAddressModal<%= index %>" tabindex="-1" role="dialog"
                      aria-labelledby="deleteAddressModalLabel<%= index %>" aria-hidden="true">
                      <div class="modal-dialog" role="document">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="deleteAddressModalLabel<%= index %>">Delete Address</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                              <span aria-hidden="true">&times;</span>
                            </button>
                          </div>
                          <div class="modal-body">
                            Are you sure you want to delete this address?
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-danger"
                              onclick="confirmDeleteAddress('<%= address._id %>')">Confirm</button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                          </div>
                        </div>
                      </div>
                    </div>
                    <% }) %>


            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Edit Name Modal -->
  <div class="modal fade" id="editNameModal" tabindex="-1" aria-labelledby="editNameModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editNameModalLabel">Edit Name</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="editNameForm">
            <div class="form-group">
              <label for="newName">New Name</label>
              <input type="text" class="form-control" id="newName" name="newName" placeholder="Enter new name">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" id="saveNameBtn">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Change Password Modal -->
  <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="changePasswordModalLabel">Change Password</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="changePasswordForm">
            <div class="form-group">
              <label for="currentPassword">Current Password</label>
              <input type="password" class="form-control" id="currentPassword" name="currentPassword"
                placeholder="Enter current password">
            </div>
            <div class="form-group">
              <label for="newPassword">New Password</label>
              <input type="password" class="form-control" id="newPassword" name="newPassword"
                placeholder="Enter new password">
            </div>
            <div class="form-group">
              <label for="confirmPassword">Confirm Password</label>
              <input type="password" class="form-control" id="confirmPassword" name="confirmPassword"
                placeholder="Confirm new password">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" id="changePasswordBtn">Save Changes</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast notification HTML for password mismatch -->
  <div class="toast" id="passwordMismatchToast" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-header">
      <strong class="me-auto">Error</strong>
      <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
    <div class="toast-body">
      New password and confirm password must match.
    </div>
  </div>

  <!-- Toast notification HTML for password change success -->
  <div class="toast" id="passwordSuccessToast" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-header">
      <strong class="me-auto">Success</strong>
      <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
    <div class="toast-body">
      Password changed successfully.
    </div>
  </div>

  <!-- Toast notification HTML for password change error -->
  <div class="toast" id="passwordErrorToast" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-header">
      <strong class="me-auto">Error</strong>
      <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
    <div class="toast-body">
      Failed to change password. Please check your current password.
    </div>
  </div>

  <footer class="main bg-secondary text-light">
    <section class="section-padding footer-mid">
      <div class="container pt-15 pb-20">
        <div class="row">
          <div class="col-lg-4 col-md-6">
            <div class="widget-about font-md mb-md-5 mb-lg-0">
              <div class="logo logo-width-1 wow fadeIn animated">
                <a href="index.html"><img src="user-assets/imgs/theme/logo.svg" alt="logo"></a>
              </div>
              <h5 class="mt-20 mb-10 fw-600 text-grey-4 wow fadeIn animated">Contact</h5>
              <p class="wow fadeIn animated">
                <strong>Address: </strong>562 Wellington Road, Street 32, San Francisco
              </p>
              <p class="wow fadeIn animated">
                <strong>Phone: </strong>+01 2222 365 /(+91) 01 2345 6789
              </p>
              <p class="wow fadeIn animated">
                <strong>Hours: </strong>10:00 - 18:00, Mon - Sat
              </p>
              <h5 class="mb-10 mt-30 fw-600 text-grey-4 wow fadeIn animated">Follow Us</h5>
              <div class="mobile-social-icon wow fadeIn animated mb-sm-5 mb-md-0">
                <a href="#"><img src="user-assets/imgs/theme/icons/icon-facebook.svg" alt=""></a>
                <a href="#"><img src="user-assets/imgs/theme/icons/icon-twitter.svg" alt=""></a>
                <a href="#"><img src="user-assets/imgs/theme/icons/icon-instagram.svg" alt=""></a>
                <a href="#"><img src="user-assets/imgs/theme/icons/icon-pinterest.svg" alt=""></a>
                <a href="#"><img src="user-assets/imgs/theme/icons/icon-youtube.svg" alt=""></a>
              </div>
            </div>
          </div>
          <div class="col-lg-2 col-md-3">
            <h5 class="widget-title wow fadeIn animated">About</h5>
            <ul class="footer-list wow fadeIn animated mb-sm-5 mb-md-0">
              <li><a href="#">About Us</a></li>
              <li><a href="#">Delivery Information</a></li>
              <li><a href="#">Privacy Policy</a></li>
              <li><a href="#">Terms &amp; Conditions</a></li>
              <li><a href="#">Contact Us</a></li>
              <li><a href="#">Support Center</a></li>
            </ul>
          </div>
          <div class="col-lg-2  col-md-3">
            <h5 class="widget-title wow fadeIn animated">My Account</h5>
            <ul class="footer-list wow fadeIn animated">
              <li><a href="#">Sign In</a></li>
              <li><a href="#">View Cart</a></li>
              <li><a href="#">My Wishlist</a></li>
              <li><a href="#">Track My Order</a></li>
              <li><a href="#">Help</a></li>
              <li><a href="#">Order</a></li>
            </ul>
          </div>
          <div class="col-lg-4">
            <h5 class="widget-title wow fadeIn animated">Install App</h5>
            <div class="row">
              <div class="col-md-8 col-lg-12">
                <p class="wow fadeIn animated">From App Store or Google Play</p>
                <div class="download-app wow fadeIn animated">
                  <a href="#" class="hover-up mb-sm-4 mb-lg-0"><img class="active"
                      src="user-assets/imgs/theme/app-store.jpg" alt=""></a>
                  <a href="#" class="hover-up"><img src="user-assets/imgs/theme/google-play.jpg" alt=""></a>
                </div>
              </div>
              <div class="col-md-4 col-lg-12 mt-md-3 mt-lg-0">
                <p class="mb-20 wow fadeIn animated">Secured Payment Gateways</p>
                <img class="wow fadeIn animated" src="user-assets/imgs/theme/payment-method.png" alt="">
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <div class="container pb-20 wow fadeIn animated">
      <div class="row">
        <div class="col-12 mb-20">
          <div class="footer-bottom"></div>
        </div>
        <div class="col-lg-6">
          <p class="float-md-left font-sm text-muted mb-0">&copy; 2022, <strong class="text-brand">Wander</strong> -
            HTML Ecommerce Template </p>
        </div>
        <div class="col-lg-6">
          <p class="text-lg-end text-start font-sm text-muted mb-0">
            Designed by <a href="http://alithemes.com" target="_blank">Alithemes.com</a>. All rights reserved
          </p>
        </div>
      </div>
    </div>
  </footer>
  <!-- Preloader Start -->
  <div id="preloader-active">
    <div class="preloader d-flex align-items-center justify-content-center">
      <div class="preloader-inner position-relative">
        <div class="text-center">
          <h5 class="mb-5">Now Loading</h5>
          <div class="loader">
            <div class="bar bar1"></div>
            <div class="bar bar2"></div>
            <div class="bar bar3"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Vendor JS-->
  <script src="user-assets/js/vendor/modernizr-3.6.0.min.js"></script>
  <script src="user-assets/js/vendor/jquery-3.6.0.min.js"></script>
  <script src="user-assets/js/vendor/jquery-migrate-3.3.0.min.js"></script>
  <script src="user-assets/js/vendor/bootstrap.bundle.min.js"></script>
  <script src="user-assets/js/plugins/slick.js"></script>
  <script src="user-assets/js/plugins/jquery.syotimer.min.js"></script>
  <script src="user-assets/js/plugins/wow.js"></script>
  <script src="user-assets/js/plugins/jquery-ui.js"></script>
  <script src="user-assets/js/plugins/perfect-scrollbar.js"></script>
  <script src="user-assets/js/plugins/magnific-popup.js"></script>
  <script src="user-assets/js/plugins/select2.min.js"></script>
  <script src="user-assets/js/plugins/waypoints.js"></script>
  <script src="user-assets/js/plugins/counterup.js"></script>
  <script src="user-assets/js/plugins/jquery.countdown.min.js"></script>
  <script src="user-assets/js/plugins/images-loaded.js"></script>
  <script src="user-assets/js/plugins/isotope.js"></script>
  <script src="user-assets/js/plugins/scrollup.js"></script>
  <script src="user-assets/js/plugins/jquery.vticker-min.js"></script>
  <script src="user-assets/js/plugins/jquery.theia.sticky.js"></script>
  <script src="user-assets/js/plugins/jquery.elevatezoom.js"></script>
  <!-- Template  JS -->
  <script src="./user-assets/js/main.js?v=3.4"></script>
  <script src="./user-assets/js/shop.js?v=3.4"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastify-js/1.11.0/toastify.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-0VtUxEz1c4t3ZT5Yel5zPFJfnz9ao0MWr+Q4+agBkoBB1jE2xkkjzr8NT/dWclgl"
    crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastify-js/1.11.0/toastify.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
    integrity="SHA-384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
    crossorigin="anonymous"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.3/dist/sweetalert2.all.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>


    function validateForm() {
      const houseName = document.getElementById("houseName").value;
      const street = document.getElementById("street").value;
      const city = document.getElementById("city").value;
      const state = document.getElementById("state").value;
      const country = document.getElementById("country").value;
      const postalCode = document.getElementById("postalCode").value;

      if (!houseName || !street || !city || !state || !country || !postalCode) {

        return false;
      }

      if (!/^[A-Za-z]+$/.test(city)) {
        document.getElementById("cityError").innerText = "City must contain only letters.";
        return false;
      }

      if (!/^[A-Za-z]+$/.test(state)) {
        document.getElementById("stateError").innerText = "State must contain only letters.";
        return false;
      }

      if (!/^[A-Za-z]+$/.test(country)) {
        document.getElementById("countryError").innerText = "Country must contain only letters.";
        return false;
      }

      if (!/^[0-9]+$/.test(postalCode)) {
        document.getElementById("postalCodeError").innerText = "Postal code must contain only numbers.";
        return false;
      }

      return true;
    }




    // Function to handle editing the name
    document.getElementById('saveNameBtn').addEventListener('click', async () => {
      const newName = document.getElementById('newName').value.trim();
      try {
        const response = await fetch('/profile/updateName', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ newName })
        });
        if (response.ok) {
          // Update the name in the profile section without refreshing
          document.querySelector('.form-group.col-md-6 input[name="name"]').value = newName;
          $('#editNameModal').modal('hide');
          window.location.reload();
        } else {
          // Handle error if any
          console.error('Error updating name');
        }
      } catch (error) {
        console.error('Error:', error);
      }
    });
    // Function to handle changing the password
    document.getElementById('changePasswordBtn').addEventListener('click', async () => {
      const currentPassword = document.getElementById('currentPassword').value.trim();
      const newPassword = document.getElementById('newPassword').value.trim();
      const confirmPassword = document.getElementById('confirmPassword').value.trim();
      if (newPassword !== confirmPassword) {
        // Show error message if passwords don't match
        alert('New password and confirm password must match.');
        return;
      }
      try {
        const response = await fetch('/profile/changePassword', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ currentPassword, newPassword })
        });
        if (response.ok) {
          // Password changed successfully
          $('#changePasswordModal').modal('hide');
          window.location.reload();
        } else {
          // Handle error if any
          alert('Failed to change password. Please check your current password.');
        }
      } catch (error) {
        console.error('Error:', error);
      }
    });
    document.getElementById("addAddressForm").addEventListener("submit", async function (event) {
      event.preventDefault();
      // Retrieve form data
      var houseName = document.getElementById("houseName").value;
      var street = document.getElementById("street").value;
      var city = document.getElementById("city").value;
      var state = document.getElementById("state").value;
      var country = document.getElementById("country").value;
      var postalCode = document.getElementById("postalCode").value;
      var addressType = document.getElementById("addressType").value;
      // Validation logic
      if (houseName.trim() === '' || street.trim() === '' || city.trim() === '' || state.trim() === '' || country.trim() === '' || postalCode.trim() === '') {
        Toastify({
          text: "Please fill in all fields",
          duration: 3000,
          gravity: "top", // toast will be shown at top of the page
          position: 'right', // toast position
          backgroundColor: "linear-gradient(to right, #00b09b, #96c93d)",
        }).showToast();
        return false;
      }
      try {
        const response = await fetch('/profile/addAddress', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json' // Specify content type as JSON
          },
          body: JSON.stringify({ // Convert form data to JSON
            houseName,
            street,
            city,
            state,
            country,
            postalCode,
            addressType
          })
        });
        if (response.ok) {
          document.getElementById("addAddressForm").reset();
          Toastify({
            text: "Address added successfully",
            duration: 3000,
            gravity: "top",
            position: 'right',
            backgroundColor: "linear-gradient(to right, #00b09b, #96c93d)",
          }).showToast();
          // window.location.reload();
          // Optionally, you can redirect the user or perform any other action here
        } else {
          Toastify({
            text: "Failed to add address",
            duration: 3000,
            gravity: "top",
            position: 'right',
            backgroundColor: "linear-gradient(to right, #ff416c, #ff4b2b)",
          }).showToast();
        }
      } catch (error) {
        console.error(error);
        Toastify({
          text: "An error occurred",
          duration: 3000,
          gravity: "top",
          position: 'right',
          backgroundColor: "linear-gradient(to right, #ff416c, #ff4b2b)",
        }).showToast();
      }
    });

    // Function to handle editing the name
    document.getElementById('saveNameBtn').addEventListener('click', async () => {
      const newName = document.getElementById('newName').value.trim();

      try {
        const response = await fetch('/profile/updateName', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ newName })
        });

        if (response.ok) {
          // Update the name in the profile section without refreshing
          document.querySelector('.form-group.col-md-6 input[name="name"]').value = newName;
          $('#editNameModal').modal('hide');
          window.location.reload();
        } else {
          // Handle error if any
          console.error('Error updating name');
        }
      } catch (error) {
        console.error('Error:', error);
      }
    });


    var passwordMismatchToast = new bootstrap.Toast(document.getElementById('passwordMismatchToast'));
    var passwordSuccessToast = new bootstrap.Toast(document.getElementById('passwordSuccessToast'));
    var passwordErrorToast = new bootstrap.Toast(document.getElementById('passwordErrorToast'));

    // Handle click event on change password button
    document.getElementById('changePasswordBtn').addEventListener('click', async () => {
      const currentPassword = document.getElementById('currentPassword').value.trim();
      const newPassword = document.getElementById('newPassword').value.trim();
      const confirmPassword = document.getElementById('confirmPassword').value.trim();

      if (newPassword !== confirmPassword) {
        // Show error toast message if passwords don't match
        passwordMismatchToast.show();
        return;
      }

      try {
        const response = await fetch('/profile/changePassword', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ currentPassword, newPassword })
        });

        if (response.ok) {
          // Password changed successfully
          $('#changePasswordModal').modal('hide');
          passwordSuccessToast.show();
          // Optionally, you can redirect the user or perform any other action here
          window.location.reload()
        } else {
          // Handle error if any
          passwordErrorToast.show();
        }
      } catch (error) {
        console.error('Error:', error);
      }
    });


    document.addEventListener('DOMContentLoaded', () => {
      const editAddressForms = document.querySelectorAll('.edit-address-form');

      editAddressForms.forEach((form, index) => {
        form.addEventListener('submit', async (e) => {
          e.preventDefault();

          const addressId = form.dataset.addressId;
          const formData = new FormData(form);
          const addressData = {};

          for (const [key, value] of formData.entries()) {
            addressData[key] = value;
          }

          try {
            const response = await fetch(`/profile/update-address/${addressId}`, {
              method: 'PUT',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify(addressData),
            });

            if (!response.ok) {
              throw new Error('Error updating address');
            }

            // Close the modal
            const modal = document.querySelector(`#editAddressModal${index}`);
            const modalBackdrop = document.querySelector('.modal-backdrop');

            modal.classList.remove('show');
            modal.style.display = 'none';

            if (modalBackdrop) {
              modalBackdrop.remove();
            }

            // Reload the page
            window.location.reload();
          } catch (err) {
            console.error(err);
            alert(err.message);
          }
        });
      });
    });


    $(document).ready(function () {
      let selectedOrderId;

      // Listen for the 'show.bs.modal' event on the cancelOrderModal
      $('#cancelOrderModal').on('show.bs.modal', function (event) {
        // Get the button that triggered the modal
        const button = $(event.relatedTarget);

        // Get the order ID from the button's data attribute
        selectedOrderId = button.data('order-id');
        console.log('Modal is being shown for orderId:', selectedOrderId);
      });

      $('#confirmCancelOrder').click(function () {
        const cancellationReason = $('#cancellationReason').val();
        console.log('Cancelling order with orderId:', selectedOrderId);
        cancelOrder(selectedOrderId, cancellationReason);
      });

      function cancelOrder(orderId, cancellationReason) {
        console.log('Cancelling order with orderId:', orderId);
        fetch(`/orders/${orderId}/cancel`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ cancellationReason })
        })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              Swal.fire({
                title: 'Success',
                text: data.message,
                icon: 'success',
              }).then(() => {
                updateOrderStatus(orderId, 'Cancelled');
              });

              window.location.reload()
              // $('#cancelOrderModal').modal('hide');
              // showToast('Order cancelled successfully', 'success');

              // window.location.reload();
              // Swal.fire({
              //   icon: 'success',
              //   title: 'Order Cancelled',
              //   text: 'Order cancelled successfully',
              //   timer: 3000,

              // });
            } else {
              showToast('Failed to cancel order', 'error');
            }
          })
          .catch(error => {
            console.error('Error cancelling order:', error);
            showToast('An error occurred while cancelling the order', 'error');
          });
      }
    })
    function updateOrderStatus(orderId, status) {
      const orderRow = $(`.order-row[data-order-id="${orderId}"]`);
      const statusBadge = orderRow.find('.order-status');
      statusBadge.text(status);
      statusBadge.removeClass('badge-warning badge-info badge-primary badge-success badge-danger');
      statusBadge.addClass(`badge-${status.toLowerCase() === 'pending' ? 'warning' : status.toLowerCase() === 'confirmed' ? 'info' : status.toLowerCase() === 'shipped' ? 'primary' : status.toLowerCase() === 'delivered' ? 'success' : 'danger'}`);
    }

    function showToast(message, type) {
      const toast = $(`
    <div class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-delay="3000">
      <div class="toast-header bg-${type} text-white">
        <strong class="mr-auto">Order Status</strong>
        <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="toast-body">
        ${message}
      </div>
    </div>
  `);

      $('.toast-container').append(toast);
      toast.toast('show');
    }



    function confirmDeleteAddress(addressId) {
      console.log(addressId);

      fetch(`/profile/address/${addressId}`, {
        method: 'DELETE',
      })
        .then(response => {
          if (response.ok) {
            $('#deleteAddressModal' + addressId).modal('hide');; // Hide the modal
            $('#addressSection_' + addressId).remove(); // Remove the address section from UI
            Swal.fire({
              icon: 'success',
              title: 'Address Deleted',
              text: 'Address successfully deleted'
            });
          } else {
            Swal.fire({
              icon: 'error',
              title: 'Error',
              text: 'Failed to delete address'
            });
          }
        })
        .catch(error => {
          console.error('Error deleting address:', error);
          Swal.fire({
            icon: 'error',
            title: 'Error',
            text: 'An error occurred while deleting the address'
          });
        });
    }



    $(document).ready(function () {
      let selectedOrderId;

      // Listen for the 'show.bs.modal' event on the returnOrderModal
      $('#returnOrderModal').on('show.bs.modal', function (event) {
        // Get the button that triggered the modal
        const button = $(event.relatedTarget);

        // Get the order ID from the button's data attribute
        selectedOrderId = button.data('order-id');
        console.log('Modal is being shown for orderId:', selectedOrderId);
      });

      // Handle click on the confirmReturnOrder button
      $('#confirmReturnOrder').click(function () {
        const returnReason = $('#returnReason').val();
        console.log('Returning order with orderId:', selectedOrderId);
        returnOrder(selectedOrderId, returnReason);
      });

      function returnOrder(orderId, returnReason) {
        console.log('Returning order with orderId:', orderId);
        fetch(`/orders/${orderId}/return`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            returnReason
          })
        })
          .then(response => response.json())
          .then(data => {
            console.log("data test", data);
            if (data.success) {
              $('#returnOrderModal').modal('hide');
              Swal.fire({
                title: 'Success',
                text: data.message,
                icon: 'success',
              }).then(() => {
                updateOrderStatus(orderId, 'Returned');
              });

              window.location.reload()
            } else {
              Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'Failed to return product'
              });
            }
          })
          .catch(error => {
            console.error('Error returning order:', error);
            showToast('An error occurred while returning the order', 'error');
          });
      }
    });


  </script>
</body>

</html>