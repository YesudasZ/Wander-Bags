<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
  <meta charset="utf-8">
  <title>Wander - eCommerce HTML Template</title>
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="og:title" content="">
  <meta property="og:type" content="">
  <meta property="og:url" content="">
  <meta property="og:image" content="">
  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="../user-assets/imgs/theme/favicon.svg">
  <!-- Template CSS -->
  <link rel="stylesheet" href="../user-assets/css/main.css?v=3.4">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

  <style>
.radio-button-small {
  width: 9px !important;;
  height: 16px !important;;
}

     .cart-section{
      border: 1px solid #ccc;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
     }

    .address-card .card {
      border: none;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    .address-card .card:hover {
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
    }

    .address-card .form-check {
      display: flex;
      align-items: center;
    }

    .address-card .form-check-label {
      flex-grow: 1;
      margin-left: 10px;
    }

    .address-card .edit-icon {
      cursor: pointer;
      color: #007bff;
      transition: all 0.3s ease;
    }

    .address-card .edit-icon:hover {
      color: #0056b3;
    }

    .cart-item {
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    .cart-item:hover {
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
    }

    .cart-item .card-body {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      height: 100%;
    }

    .cart-item-actions,
    .cart-item-total,
    .cart-item-select {
      margin-top: 10px;
    }

    .cart-item-actions .btn {
      padding: 0.25rem 0.5rem;
    }

    .payment-section {
      background-color: #f8f9fa;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .place-order-btn {
      width: 100%;
      margin-top: 20px;
    }


    /* Footer Styling */
    footer.main {
      padding-top: 40px;
      padding-bottom: 40px;
    }

    .widget-about p {
      color: #a8a8a8;
      line-height: 1.8;
    }

    .social-icons a {
      display: inline-block;
      margin-right: 10px;
    }

    .widget-title {
      color: #fff;
      font-weight: bold;
    }

    .footer-list li {
      list-style: none;
    }

    .download-app img {
      max-width: 130px;
      margin-right: 10px;
      margin-bottom: 10px;
    }

    .font-sm {
      font-size: 14px;
    }

    .text-light {
      color: #fff !important;
    }

    .text-muted {
      color: #a8a8a8 !important;
    }

    .header-info-right ul li {
      display: inline;
      margin-left: 20px;
    }

    .header-info-right ul li:first-child {
      margin-left: 0;
    }

    .header-info-right a {
      text-decoration: none;
      color: #343a40;
      /* Adjust text color as needed */
    }

    .header-info-right a:hover {
      text-decoration: underline;
    }

    .header-info-right .fi-rs-user {
      margin-right: 5px;
    }
  </style>
</head>

<body>
  <!-- Quick view -->
  <header class="header-area header-style-4 header-height-2">
    <div class="header-middle header-middle-ptb-1 d-none d-lg-block">
        <div class="container">
            <div class="header-wrap d-flex justify-content-between align-items-center">
                <div class="logo logo-width-1">
                    <a href="index.html"><img src="user-assets/imgs/theme/logo.svg" alt="logo"></a>
                </div>
                <div class="header-right d-flex align-items-center">
                    <div class="search-style-2">
                        <form action="#">
                            <select class="select-active">
                                <option>All Categories</option>
                            </select>
                            <input type="text" placeholder="Search for items...">
                        </form>
                    </div>
                    <div class="header-action-right d-flex align-items-center">
                        <div class="header-action-2">
                            <div class="header-action-icon-2">
                                <a href="/wishList">
                                    <img class="svgInject" alt="Wander" src="user-assets/imgs/theme/icons/icon-heart.svg">
                                    
                                </a>
                            </div>
                            <div class="header-action-icon-2">
                                <a class="mini-cart-icon" href="/cart">
                                    <img alt="Wander" src="user-assets/imgs/theme/icons/icon-cart.svg">
                                    
                                </a>
                            </div>
                        </div>
                        <div class="header-info header-info-right text-end">
                            <ul class="list-inline mb-0">
                           
                                <li class="dropdown nav-item m-5">
                                    <a class="dropdown-toggle text-black" href="#" role="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                        <i class="fi-rs-user"></i> <%= user.name %>
                                    </a>
                                    <div class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownAccount">
                                        <a class="dropdown-item" href="/profile"><i class="material-icons md-perm_identity"></i>Profile</a>
                                        <a class="dropdown-item" href="#"><i class="material-icons md-settings"></i>Orders</a>
                                        <a class="dropdown-item" href="#"><i class="material-icons md-account_balance_wallet"></i>Wallet</a>
                                        <div class="dropdown-divider"></div>
                                        <a class="dropdown-item text-danger" href="/logout"><i class="material-icons md-exit_to_app"></i>Logout</a>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="header-bottom header-bottom-bg-color sticky-bar">
        <div class="container">
            <div class="header-wrap header-space-between position-relative">
                <div class="logo logo-width-1 d-block d-lg-none">
                    <a href="index.html"><img src="user-assets/imgs/theme/logo.svg" alt="logo"></a>
                </div>
                <div class="header-nav d-none d-lg-flex">
                    <div class="main-menu main-menu-padding-1 main-menu-lh-2 d-none d-lg-block">
                        <nav>
                            <ul>
                                <li><a class="active" href="/home">Home</a></li>
                                <li><a href="/shop">Shop</a></li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>





  <main>
    <div class="container mt-5 mb-5">
      <h1 class="text-center mb-4"></h1>
      <div class="row">
        <div class="col-md-4">

          <div class="address-section">
            <h3>Delivery Address</h3>
            <div class="existing-address">
              <div class="address-list">
                <!-- Display existing addresses dynamically -->
                <form id="placeOrderForm">
                  <% user.address.forEach((address, index)=> { %>
                  <div class="address-card mb-3">
                    <div class="card">
                      <div class="card-body">
                        <div class="form-check">
                          <input type="radio" name="address" id="<%= address._id %>" value="<%= address._id %>" class="form-check-input" required>
                          <label for="<%= address._id %>" class="form-check-label">
                            <%= address.houseName %> <br>
                            <%= address.street %><br>
                            <%= address.city %><br>
                            <%= address.state %><br>
                            <%= address.country %><br>
                            <%= address.postalCode %>
                          </label>
                        </div>
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#editAddressModal<%= index %>">Edit</button>
                      </div>
                    </div>
                  </div>
                  <% }); %>
                </form>
              </div>
            </div>
          </div>
          <button type="button"  class="btn btn-secondary" data-toggle="modal" data-target="#addAddressModal" >
            Add Address
          </button>
        </div>
   
        <div class="col-md-8">
          <div class="cart-section p-5">
            <div class="mb-20">
              <h4>Your Orders</h4>
            </div>
            <div class="cart-items">
              <!-- Cart items -->
              <% cart.items.forEach(item=> { %>
              <div class="cart-item mb-3">
                <div class="row g-0 align-items-center">
                  <div class="col-md-3">
                    <img src="/productImages/<%= item.image[0] %>" alt="Product Image" class="img-fluid">
                  </div>
               
                  <div class="col-md-6">
                    <div class="card-body">
                      <h5 class="card-title"><%= item.title %></h5>
                      <p class="card-text">Discounted Price: ₹.<%= item.productPrice %></p>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="quantity-wrapper d-flex align-items-center justify-content-end">
                      <button class="btn btn-sm btn-outline-secondary decrease-quantity" data-id="<%= item._id %>" data-price="<%= item.productPrice %>">-</button>
                      <input type="number" class="form-control black-border black-spin-buttons trendy-quantity-input text-center quantity" value="<%= item.quantity %>" min="1" max="4" data-id="<%= item._id %>" data-price="<%= item.productPrice %>"  readonly>
                      <button class="btn btn-sm btn-outline-success increase-quantity" data-id="<%= item._id %>" data-price="<%= item.productPrice %>">+</button>
                    </div>
                    <div class="text-right subtotal mt-2" data-title="Total" id="price-<%= item._id %>">
                      <strong>Total: ₹.<span class="item-total"><%= item.price %></span></strong>
                    </div>
                  </div>
                </div>
              </div>
              <% }); %>
            </div>
     

            <div class="text-right">
              <button class="btn btn-primary" data-toggle="modal" data-target="#applyCouponModal">Apply Coupon</button>
            </div>


            <table class="table">
              <tbody>
                <tr>
                  <th colspan="3" id="cart-subtotal">SubTotal</th>
                  <td id="subtotalAmount">₹.<%= cart.billTotal %></td>
                </tr>
                <tr>
                  <th colspan="3">Shipping</th>
                  <td><em>Free Shipping</em></td>
                </tr>
                <tr>
                  <th colspan="3">Total</th>
                  <td><span class="font-xl text-brand fw-900" id="totalAmount">₹.<%= cart.billTotal %></span></td>
                </tr>
              </tbody>
            </table>
            <div class="bt-1 border-color-1 mt-30 mb-30"></div>




            <div class="form-group">
              <label for="orderNotes">Order Notes (Optional)</label>
              <textarea class="form-control" id="orderNotes" rows="3"></textarea>
            </div>

                <div class="bt-1 border-color-1 mt-30 mb-30"></div>
                <div class="form-group">
                  <label>Payment Method:</label>
                  <div class="d-flex align-items-center">
                    <div class="form-check me-3">
                      <input class="form-check-input radio-button-small m-2" type="radio" name="paymentMethod" id="creditCard" value="Razorpay">
                      <label class="form-check-label" for="creditCard">Razorpay</label>
                    </div>
                    <div class="form-check me-3">
                      <input class="form-check-input radio-button-small m-2" type="radio" name="paymentMethod" id="paypal" value="Paypal">
                      <label class="form-check-label" for="paypal">Paypal</label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input radio-button-small m-2" type="radio" name="paymentMethod" id="cashOnDelivery" value="Cash On Delivery">
                      <label class="form-check-label" for="cashOnDelivery">Cash On Delivery</label>
                    </div>
                  </div>
                  <div id="PaymentTypeError" class="error text-danger mt-2"></div>
                </div>

            <button type="button" class="btn btn-success btn-lg btn-block mt-30" id="placeOrderBtn">Place Order</button>
          </div>
        </div>
      </div>
    </div>
  </main>
  <!-- Edit Address Modal -->
  <% user.address.forEach((address, index)=> { %>
    <div class="modal fade" id="editAddressModal<%= index %>" tabindex="-1" role="dialog"
      aria-labelledby="editAddressModalLabel<%= index %>" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="editAddressModalLabel<%= index %>">Edit Address</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <!-- Form for editing address -->
            <form id="editAddressForm<%= index %>" class="edit-address-form" data-address-id="<%= address._id %>">
              <div class="form-group">
                <label for="houseName<%= index %>">House Name / Flat No.</label>
                <input type="text" class="form-control" id="houseName<%= index %>" name="houseName"
                  value="<%= address.houseName %>" required>
              </div>
              <div class="form-group">
                <label for="street<%= index %>">Street</label>
                <input type="text" class="form-control" id="street<%= index %>" name="street"
                  value="<%= address.street %>" required>
              </div>
              <div class="form-group">
                <label for="city<%= index %>">City</label>
                <input type="text" class="form-control" id="city<%= index %>" name="city" value="<%= address.city %>"
                  required>
              </div>
              <div class="form-group">
                <label for="state<%= index %>">State</label>
                <input type="text" class="form-control" id="state<%= index %>" name="state" value="<%= address.state %>"
                  required>
              </div>
              <div class="form-group">
                <label for="country<%= index %>">Country</label>
                <input type="text" class="form-control" id="country<%= index %>" name="country"
                  value="<%= address.country %>" required>
              </div>
              <div class="form-group">
                <label for="postalCode<%= index %>">Postal Code</label>
                <input type="text" class="form-control" id="postalCode<%= index %>" name="postalCode"
                  value="<%= address.postalCode %>" required>
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Update</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <% }) %>



    <div class="modal fade" id="addAddressModal" tabindex="-1" role="dialog" aria-labelledby="addAddressModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addAddressModalLabel">Add Address</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
   
            <form id="addAddressForm" method="post" onsubmit="return validateForm(event)">
              <div class="row">
                <div class="form-group col-md-6">
                  <label>House Name / Flat No.<span class="required">*</span></label>
                  <input  class="form-control square" name="houseName" id="houseName" type="text">
                  <small class="text-danger invalid-feedback"></small>
                </div>
                <div class="form-group col-md-6">
                  <label>Street<span class="required">*</span></label>
                  <input  class="form-control square" name="street" id="street" type="text">
                  <small class="text-danger invalid-feedback"></small>
                </div>
                <div class="form-group col-md-12">
                  <label>City <span class="required">*</span></label>
                  <input  class="form-control square" name="city" id="city" type="text" pattern="^[a-zA-Z\s]+$">
                  <small class="text-danger invalid-feedback">gjagjkgajkhgf</small>
                </div>
                <div class="form-group col-md-12">
                  <label>State <span class="required">*</span></label>
                  <input  class="form-control square" name="state" id="state" type="text" pattern="^[a-zA-Z\s]+$">
                  <small class="text-danger invalid-feedback"></small>
                </div>
                <div class="form-group col-md-12">
                  <label>Country <span class="required">*</span></label>
                  <input class="form-control square" name="country" id="country" type="text" pattern="^[a-zA-Z\s]+$">
                  <small class="text-danger invalid-feedback"></small>
                </div>
                <div class="form-group col-md-12">
                  <label>Postalcode <span class="required">*</span></label>
                  <input class="form-control square" name="postalCode" id="postalCode" type="text" pattern="^[0-9]+$">
                  <small class="text-danger invalid-feedback"></small>
                </div>
                <div class="form-group col-md-12">
                  <label>Type <span class="required">*</span></label>
                  <select class="form-control" id="addressType" name="addressType">
                    <option value="home">Home</option>
                    <option value="office">Office</option>
                  </select>
                  <small class="text-danger invalid-feedback"></small>
                </div>
                <!-- <div class="col-md-12">
                  <button type="submit" class="btn btn-fill-out submit" name="submit" value="Submit">Save</button>
                </div> -->
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="submit" form="addAddressForm" class="btn btn-primary">Save</button>
          </div>
        </div>
      </div>
    </div>




<div class="modal fade" id="applyCouponModal" tabindex="-1" role="dialog" aria-labelledby="applyCouponModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="applyCouponModalLabel">Apply Coupon</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <% if (coupons.length === 0) { %>
          <p>No coupons available for this order.</p>
        <% } else { %>
          <% coupons.forEach(coupon => { %>
            <div class="coupon-item">
              <h6><%= coupon.name %></h6>
              <p>Minimum Purchase Amount: ₹.<%= coupon.minimumAmount %></p>
              <p>Maximum Discount Amount: ₹.<%= coupon.maximumAmount %></p>
              <p>Discount: <%= coupon.discount %>%</p>
              <p class="coupon-code"><%= coupon.couponCode %></p>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="selectedCoupon" id="coupon-<%= coupon._id %>" value="<%= coupon._id %>">
                <label class="form-check-label" for="coupon-<%= coupon._id %>">
                  Select this coupon
                </label>
              </div>
            </div>
          <% }) %>
        <% } %>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="applyCouponBtn">Apply Coupon</button>
      </div>
    </div>
  </div>
</div>




      <footer class="main bg-secondary text-light">
        <section class="section-padding footer-mid">
          <div class="container pt-15 pb-20">
            <div class="row">
              <div class="col-lg-4 col-md-6">
                <div class="widget-about font-md mb-md-5 mb-lg-0">
                  <div class="logo logo-width-1 wow fadeIn animated">
                    <a href="index.html"><img src="../user-assets/imgs/theme/logo.svg" alt="logo"></a>
                  </div>
                  <h5 class="mt-20 mb-10 fw-600 text-grey-4 wow fadeIn animated">Contact</h5>
                  <p class="wow fadeIn animated">
                    <strong>Address: </strong>562 Wellington Road, Street 32, San Francisco
                  </p>
                  <p class="wow fadeIn animated">
                    <strong>Phone: </strong>+01 2222 365 /(+91) 01 2345 6789
                  </p>
                  <p class="wow fadeIn animated">
                    <strong>Hours: </strong>10:00 - 18:00, Mon - Sat
                  </p>
                  <h5 class="mb-10 mt-30 fw-600 text-grey-4 wow fadeIn animated">Follow Us</h5>
                  <div class="mobile-social-icon wow fadeIn animated mb-sm-5 mb-md-0">
                    <a href="#"><img src="../user-assets/imgs/theme/icons/icon-facebook.svg" alt=""></a>
                    <a href="#"><img src="../user-assets/imgs/theme/icons/icon-twitter.svg" alt=""></a>
                    <a href="#"><img src="../user-assets/imgs/theme/icons/icon-instagram.svg" alt=""></a>
                    <a href="#"><img src="../user-assets/imgs/theme/icons/icon-pinterest.svg" alt=""></a>
                    <a href="#"><img src="../user-assets/imgs/theme/icons/icon-youtube.svg" alt=""></a>
                  </div>
                </div>
              </div>
              <div class="col-lg-2 col-md-3">
                <h5 class="widget-title wow fadeIn animated">About</h5>
                <ul class="footer-list wow fadeIn animated mb-sm-5 mb-md-0">
                  <li><a href="#">About Us</a></li>
                  <li><a href="#">Delivery Information</a></li>
                  <li><a href="#">Privacy Policy</a></li>
                  <li><a href="#">Terms &amp; Conditions</a></li>
                  <li><a href="#">Contact Us</a></li>
                  <li><a href="#">Support Center</a></li>
                </ul>
              </div>
              <div class="col-lg-2  col-md-3">
                <h5 class="widget-title wow fadeIn animated">My Account</h5>
                <ul class="footer-list wow fadeIn animated">
                  <li><a href="#">Sign In</a></li>
                  <li><a href="#">View Cart</a></li>
                  <li><a href="#">My Wishlist</a></li>
                  <li><a href="#">Track My Order</a></li>
                  <li><a href="#">Help</a></li>
                  <li><a href="#">Order</a></li>
                </ul>
              </div>
              <div class="col-lg-4">
                <h5 class="widget-title wow fadeIn animated">Install App</h5>
                <div class="row">
                  <div class="col-md-8 col-lg-12">
                    <p class="wow fadeIn animated">From App Store or Google Play</p>
                    <div class="download-app wow fadeIn animated">
                      <a href="#" class="hover-up mb-sm-4 mb-lg-0"><img class="active"
                          src="../user-assets/imgs/theme/app-store.jpg" alt=""></a>
                      <a href="#" class="hover-up"><img src="../user-assets/imgs/theme/google-play.jpg" alt=""></a>
                    </div>
                  </div>
                  <div class="col-md-4 col-lg-12 mt-md-3 mt-lg-0">
                    <p class="mb-20 wow fadeIn animated">Secured Payment Gateways</p>
                    <img class="wow fadeIn animated" src="../user-assets/imgs/theme/payment-method.png" alt="">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
        <div class="container pb-20 wow fadeIn animated">
          <div class="row">
            <div class="col-12 mb-20">
              <div class="footer-bottom"></div>
            </div>
            <div class="col-lg-6">
              <p class="float-md-left font-sm text-muted mb-0">&copy; 2022, <strong class="text-brand">Wander</strong> -
                HTML Ecommerce Template </p>
            </div>
            <div class="col-lg-6">
              <p class="text-lg-end text-start font-sm text-muted mb-0">
                Designed by <a href="http://alithemes.com" target="_blank">Alithemes.com</a>. All rights reserved
              </p>
            </div>
          </div>
        </div>
      </footer>
      <!-- Preloader Start -->
      <div id="preloader-active">
        <div class="preloader d-flex align-items-center justify-content-center">
          <div class="preloader-inner position-relative">
            <div class="text-center">
              <h5 class="mb-5">Now Loading</h5>
              <div class="loader">
                <div class="bar bar1"></div>
                <div class="bar bar2"></div>
                <div class="bar bar3"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Vendor JS-->
      <script src="../user-assets/js/vendor/modernizr-3.6.0.min.js"></script>
      <script src="../user-assets/js/vendor/jquery-3.6.0.min.js"></script>
      <script src="../user-assets/js/vendor/jquery-migrate-3.3.0.min.js"></script>
      <script src="../user-assets/js/vendor/bootstrap.bundle.min.js"></script>
      <script src="../user-assets/js/plugins/slick.js"></script>
      <script src="../user-assets/js/plugins/jquery.syotimer.min.js"></script>
      <script src="../user-assets/js/plugins/wow.js"></script>
      <script src="../user-assets/js/plugins/jquery-ui.js"></script>
      <script src="../user-assets/js/plugins/perfect-scrollbar.js"></script>
      <script src="../user-assets/js/plugins/magnific-popup.js"></script>
      <script src="../user-assets/js/plugins/select2.min.js"></script>
      <script src="../user-assets/js/plugins/waypoints.js"></script>
      <script src="../user-assets/js/plugins/counterup.js"></script>
      <script src="../user-assets/js/plugins/jquery.countdown.min.js"></script>
      <script src="../user-assets/js/plugins/images-loaded.js"></script>
      <script src="../user-assets/js/plugins/isotope.js"></script>
      <script src="../user-assets/js/plugins/scrollup.js"></script>
      <script src="../user-assets/js/plugins/jquery.vticker-min.js"></script>
      <script src="../user-assets/js/plugins/jquery.theia.sticky.js"></script>
      <script src="../user-assets/js/plugins/jquery.elevatezoom.js"></script>
      <!-- Template  JS -->
      <script src="./../user-assets/js/main.js?v=3.4"></script>
      <script src="./../user-assets/js/shop.js?v=3.4"></script>
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.7.2/icons/pencil-square.min.svg"></script>

      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.3/dist/sweetalert2.all.min.js"></script>

      <script>

let totalAmount = parseFloat("<%= cart.billTotal %>");
let subtotalAmount = parseFloat("<%= cart.billTotal %>");

function updateQuantity(input, change) {
  const productId = input.dataset.id;
  const currentQuantity = parseInt(input.value);
  const newQuantity = currentQuantity + change;
  const itemPrice = parseFloat(input.dataset.price);

  if (newQuantity >= 1 && newQuantity <= 5) {
    fetch(`/cart/update/${productId}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ quantity: newQuantity })
    })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          input.value = newQuantity;
          const priceElement = document.getElementById(`price-${productId}`);
          const newItemTotal = itemPrice * newQuantity;
          priceElement.querySelector('.item-total').textContent = `${newItemTotal.toFixed(2)}`;

          updateTotals(newItemTotal - (itemPrice * currentQuantity));
          showAlert(data.message, 'success');
        } else {
          showAlert(data.message, 'error');
        }
      })
      .catch(error => {
        console.error('Error updating quantity:', error);
        showAlert('An error occurred while updating the quantity.', 'error');
      });
  } else {
    showAlert('Quantity must be between 1 and 5.', 'error');
  }
}

function updateTotals(priceChange) {
  subtotalAmount += priceChange;
  totalAmount += priceChange;

  document.getElementById('subtotalAmount').textContent = `₹.${subtotalAmount.toFixed(2)}`;
  document.getElementById('totalAmount').textContent = `₹.${totalAmount.toFixed(2)}`;
}

// Add event listeners for quantity buttons
const quantityButtons = document.querySelectorAll('.decrease-quantity, .increase-quantity');
quantityButtons.forEach(button => {
  button.addEventListener('click', () => {
    const input = button.parentNode.querySelector('input.trendy-quantity-input');
    const change = button.classList.contains('increase-quantity') ? 1 : -1;
    updateQuantity(input, change);
  });
});

        document.addEventListener('DOMContentLoaded', () => {
          const editAddressForms = document.querySelectorAll('.edit-address-form');

          editAddressForms.forEach((form, index) => {
            form.addEventListener('submit', async (e) => {
              e.preventDefault();

              const addressId = form.dataset.addressId;
              const formData = new FormData(form);
              const addressData = {};

              for (const [key, value] of formData.entries()) {
                addressData[key] = value;
              }

              try {
                const response = await fetch(`/profile/update-address/${addressId}`, {
                  method: 'PUT',
                  headers: {
                    'Content-Type': 'application/json',
                  },
                  body: JSON.stringify(addressData),
                });

                if (!response.ok) {
                  throw new Error('Error updating address');
                }

                // Close the modal
                const modal = document.querySelector(`#editAddressModal${index}`);
                const modalBackdrop = document.querySelector('.modal-backdrop');

                modal.classList.remove('show');
                modal.style.display = 'none';

                if (modalBackdrop) {
                  modalBackdrop.remove();
                }

                // Reload the page
                window.location.reload();
              } catch (err) {
                console.error(err);
                alert(err.message);
              }
            });
          });
        });



       // JavaScript
const placeOrderForm = document.getElementById('placeOrderForm');
const placeOrderBtn = document.getElementById('placeOrderBtn');

placeOrderBtn.addEventListener('click', () => {
  const addressRadios = placeOrderForm.querySelectorAll('input[name="address"]');
  const selectedAddress = Array.from(addressRadios).find(radio => radio.checked);

  if (!selectedAddress) {
    Swal.fire({
            title: 'Reminder',
            text: 'Please select address',
            icon: 'warning'
        });
        return; 
  }

  const paymentMethodRadio = document.querySelectorAll('input[name="paymentMethod"]');
  let paymentMethod = null;
    paymentMethodRadio.forEach(method => {
        if (method.checked) {
            paymentMethod = method.value;
        }
    });

    console.log(paymentMethod, "Payment Method");
  console.log("working");
  if (!paymentMethod) {
    Swal.fire({
            title: 'Reminder',
            text: 'Payment method pending',
            icon: 'warning'
        });
        return; 
  }

  const addressId = selectedAddress.value;

  const orderNotes = document.getElementById('orderNotes').value;
if(paymentMethod == "Cash On Delivery" ){
 
  fetch('/checkout', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
     
    },
    body: JSON.stringify({ addressId, paymentMethod, orderNotes }),
  })
    .then(response => {
      if (response.ok) {
      
        console.log('Order placed successfully');
        window.location.href = '/orderPlaced';
       
      } else {
        
        console.error('Failed to place order');
        
      }
    })
    .catch(error => {
      console.error('Error:', error);
      
    });}else if(paymentMethod == "Razorpay" ){

createRazorpayOrder()
      function  createRazorpayOrder(){
  fetch('/create/razorpayOrder',{
        method:'POST',
        headers:{
            'Content-Type':'application/json',
        }
    })
    .then(response => response.json())
    .then(data =>{
      console.log("TEST",data);
        const options = {
            key:'rzp_test_U3ASSzGpya8Oey',
            amount: data.amount,
            order_id: data.id,
            name:'Wander',
            description: 'Payment for Order',
            handler: function (response) {
                console.log('payment successfull', response);
                placeOrderAfterPayment();
            }
            // ,
            // prefill:{
            //     email: data.email
            // }
            ,
            theme:{
                color:'#002D75'
            }
        };
       
        const rzp = new Razorpay(options);
        rzp.open();
    })
    .catch(error => {
        console.error('Error creating RazorPay order:', error);
    })
}

function placeOrderAfterPayment(){

  fetch('/checkout', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
     
    },
    body: JSON.stringify({ addressId, paymentMethod, orderNotes }),
  })
    .then(response => {
      if (response.ok) {
       
        console.log('Order placed successfully');
        window.location.href = '/orderPlaced';
       
      } else {
       
        console.error('Failed to place order');
        
      }
    })
    .catch(error => {
      console.error('Error:', error);
     
    })
}

    }
});





function validateForm(event) {
  event.preventDefault(); 

  
  const houseNameField = document.getElementById('houseName');
  const streetField = document.getElementById('street');
  const cityField = document.getElementById('city');
  const stateField = document.getElementById('state');
  const countryField = document.getElementById('country');
  const postalCodeField = document.getElementById('postalCode');
  const addressTypeField = document.getElementById('addressType');

 
  const invalidFeedbacks = document.querySelectorAll('.invalid-feedback');
  invalidFeedbacks.forEach(feedback => feedback.textContent = '');

  let isValid = true;

 
  if (houseNameField.value.trim() === '') {
    houseNameField.nextElementSibling.textContent = 'Please enter a house name/flat no.';
    isValid = false;
  }

  if (streetField.value.trim() === '') {
    streetField.nextElementSibling.textContent = 'Please enter a street.';
    isValid = false;
  }

  

  if (isValid) {
   
    addAddress();
  }
}

function addAddress() {
  const formData = new FormData(document.getElementById('addAddressForm'));

  fetch('/profile/addAddress', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(Object.fromEntries(formData))
  })
  .then(response => {
    if (response.ok) {
      return response.text();
    } else {
      throw new Error('Failed to add address');
    }
  })
  .then(data => {
    Swal.fire({
      icon: 'success',
      title: 'Address Added',
      text: data
    });

   
    const modal = document.getElementById('addAddressModal');
    const modalBackdrop = document.querySelector('.modal-backdrop');
    modal.classList.remove('show');
    modal.setAttribute('aria-hidden', 'true');
    modal.style.display = 'none';
    if (modalBackdrop) {
      modalBackdrop.remove();
    }

    
    document.getElementById('addAddressForm').reset();
    
  
    fetchAndDisplayAddress();
    setTimeout(() => {
        window.location.reload();
      }, 1000);
  
  })
  .catch(error => {
    Swal.fire({
      icon: 'error',
      title: 'Oops...',
      text: error.message
    });
  });
}

function fetchAndDisplayAddress() {
  fetch('/admin/checkout')
    .then(response => response.json())
    .then(addresses => {
      const addressList = document.querySelector('.address-list');
      addressList.innerHTML = ''; 

      addresses.forEach(address => {
        const addressCard = document.createElement('div');
        addressCard.classList.add('address-card', 'mb-3');
        addressCard.innerHTML = `
          <div class="card">
            <div class="card-body">
              <div class="form-check">
                <input type="radio" name="address" id="${address._id}" value="${address._id}" class="form-check-input" required>
                <label for="${address._id}" class="form-check-label">
                  ${address.houseName}<br>
                  ${address.street}<br>
                  ${address.city}<br>
                  ${address.state}<br>
                  ${address.country}<br>
                  ${address.postalCode}
                </label>
              </div>
              <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#editAddressModal">Edit</button>
            </div>
          </div>
        `;

        addressList.appendChild(addressCard);
      });
    })
    .catch(error => {
      console.error('Error fetching addresses:', error);
    });
}




const applyCouponBtn = document.getElementById('applyCouponBtn');
let isCouponApplied = false; // Flag to track if a coupon has been applied

applyCouponBtn.addEventListener('click', async () => {
  if (isCouponApplied) {
  //  showAlert('A coupon has already been applied for this order.', 'info');

   
    return  Swal.fire({
      icon: 'info',
      title: 'Coupon',
      text: 'A coupon has already been applied for this order.'
    });;
  }

  const selectedCouponId = document.querySelector('input[name="selectedCoupon"]:checked').value;

  try {
    const response = await fetch('/apply-coupon', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ couponId: selectedCouponId })
    });

    const data = await response.json();

    if (data.success) {
      const couponDiscountAmount = data.couponDiscount;
      const updatedTotalAmount = data.updatedTotalAmount;

      const couponDiscountElement = document.createElement('tr');
      couponDiscountElement.innerHTML = `
        <th colspan="3">Coupon Discount</th>
        <td>-₹.${couponDiscountAmount.toFixed(2)}</td>
      `;
      const tableBody = document.querySelector('table tbody');
      tableBody.insertBefore(couponDiscountElement, tableBody.lastElementChild);

      document.getElementById('totalAmount').textContent = `₹.${updatedTotalAmount.toFixed(2)}`;

      // Close the modal
      const modal = document.getElementById('applyCouponModal');
      const modalBackdrop = document.querySelector('.modal-backdrop');

      modal.classList.remove('show');
      modal.style.display = 'none';

      if (modalBackdrop) {
        modalBackdrop.remove();
      }

      // Disable the "Apply Coupon" button
      applyCouponBtn.disabled = true;
      isCouponApplied = true;

      showAlert(data.message, 'success');
    } else {
      showAlert(data.message, 'error');
    }
  } catch (error) {
    console.error('Error applying coupon:', error);
    showAlert('An error occurred while applying the coupon.', 'error');
  }
});


function showAlert(message, type) {
  Swal.fire({
          icon: type,
          title: type === 'success' ? 'Success' : 'Error',
          text: message
      });
  console.log(`${type}: ${message}`);
}

      </script>

      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>


</body>

</html>